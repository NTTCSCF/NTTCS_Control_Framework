{% extends "base.html" %}

{% block titulo %} Assessment {% endblock %}

{% block contenido %}

<div class="rowTitulo">
    <!-- Titulo con el nombre del assessment -->
    <div class="cajaTitulo">
        <h1>{{NombreAss}}</h1>
    </div>
</div>

<div class="rowTitulo">
    <!-- Seleccion de assesment creado -->
    <form class="contenedorSelector" method="post" id="form">
        {% csrf_token %}
            <div class="cajasTextoSelectorAssessment">
                <label style="font-size: 1.4vw;" for="selector"> Seleccione un Control</label>
            </div>
            <div class="cajasSelectorAssessment">
                <select  class="selectpicker" data-width="100%" aria-label="Default select example" data-live-search="true"  onchange="this.form.submit()"  id="selector" name="selector">
                    <option selected value="noSel">--- No Seleccionado ---</option>
                    {% for ids in assess %}
                    {% if ids.control_id == control.control_id %}
                    {% if ids.respuesta == None %}
                    <option selected value="{{ids.control_id}}" title="{{ids.control_id}}" data-content="<div class='rowSelect' title='{{ids.control_name}}'> <div class='selectorCajaDentroTexto'>{{ids.control_id}}</div> <div class='selectorCajaDentroCheck'></div></div> "></option>
                    {% else %}
                    <option selected value="{{ids.control_id}}" title="{{ids.control_id}}" data-content="<div class='rowSelect' title='{{ids.control_name}}'> <div class='selectorCajaDentroTexto'>{{ids.control_id}}</div> <div class='selectorCajaDentroCheck'><i class='bi bi-check2-circle'></i></div></div> "></option>
                    {% endif %}
                    {% else %}
                    {% if ids.respuesta == None %}
                    <option value="{{ids.control_id}}" title="{{ids.control_id}}" data-content="<div class='rowSelect' title='{{ids.control_name}}'> <div class='selectorCajaDentroTexto'>{{ids.control_id}}</div> <div class='selectorCajaDentroCheck'></div></div> "></option>
                    {% else %}
                    <option value="{{ids.control_id}}" title="{{ids.control_id}}" data-content="<div class='rowSelect' title='{{ids.control_name}}'> <div class='selectorCajaDentroTexto'>{{ids.control_id}}</div> <div class='selectorCajaDentroCheck'><i class='bi bi-check2-circle'></i></div></div> "></option>
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
    </form>
</div>



<div class="rowCajas" >
    <!-- Tarjeta del nombre del control -->
    <div class="cajaNombreControl" >
        <div class="tarjeta">
            <div class="tituloTarjeta">
                <div class="cuadroayuda"></div>
                <div class="cuadrotexto">
                    Nombre del control
                </div>
                <div class="cuadroayuda" data-toggle="tooltip" data-bs-placement="top" title="Aqui se muestra el nombre del control seleccionado">
                    <i class="bi bi-info-circle"></i>
                </div>
            </div>
            <div class="textoTarjeta">
                <div class="cuadrotexto">
                    {{control.control_name}}
                </div>
            </div>
        </div>
    </div>


    <!-- Tarjeta de descripcion del control -->
    <div class="cajaPreguntaDescripcion" >
        <div class="tarjeta">
            <div class="tituloTarjeta">
                <div class="cuadroayuda"></div>
                <div class="cuadrotexto">
                    Descripción del control
                </div>
                <div class="cuadroayuda" data-toggle="tooltip" data-bs-placement="top" title="Se muestra una descripción del control para tener mas información sobre este">
                    <i class="bi bi-info-circle"></i>
                </div>

            </div>
            <div class="textoTarjeta">
                <div class="cuadrotexto">
                    {{control.descripcion}}
                </div>
            </div>
        </div>
    </div>

    <!-- Tarjeta de pregunta para el control -->
    <div class="cajaPreguntaDescripcion">
        <div class="tarjeta">
            <div class="tituloTarjeta">
                <div class="cuadroayuda"></div>
                <div class="cuadrotexto">
                    Pregunta para el control
                </div>
                <div class="cuadroayuda" data-toggle="tooltip" data-bs-placement="top" title="Se muestra la pregunta la cual se ha de contestar en el apartado de entrada de texto que se encuentra justo debajo.">
                    <i class="bi bi-info-circle"></i>
                </div>
            </div>
            <div class="textoTarjeta">
                <div class="cuadrotexto">
                    {{control.pregunta}}
                </div>
            </div>
        </div>
    </div>
</div>


<form class="cajaForm" method="post" id="form2">
    {% csrf_token %}
    <div class="rowCajas">
        <!-- Captura de la respuesta escrita -->
        <div class="cajaEditorTexto">
            {% if control.respuesta == None %}
            <textarea style="height:100%;" id="editor" name="respuesta"></textarea>
            {% else %}
            <textarea style="height:100%;" id="editor" name="respuesta">{{control.respuesta}}</textarea>
            {% endif %}
            <!-- Script para el uso del editor de texto -->
            <script type="text/javascript">

                $(function() {
                    $('textarea').each(function () {
                        const editor = Jodit.make('#editor', {
                            "spellcheck": true,
                            "language": "es",
                            placeholder:"Escriba aqui la respuesta para la pregunta de este control...",
                            height: "400",
                            allowResizeX: false,
                            allowResizeY: false
                        });
                    });
                });


            </script>
        </div>

    </div>
    <div class="rowCajas">
        <!-- Caja de seleccion para ingresar la valoracion de madurez -->
        <div class="contenedorSelector">
            <div class="cajasTextoSelectorValoracion">
                <label style="font-size: 1.4vw;">Valoración de madurez</label>
            </div>
            <div class="cajasSelectorValoracion">
                <select  class="selectpicker " data-width="100%" data-size="10"   data-live-search="true" id="valmad" name="valmad" >
                    <option selected value="noSel">--- No Seleccionado ---</option>
                    {% for ids in valMad %}
                    {% if ids.sublevels == control.valoracion %}
                    <option selected  value="{{ids.sublevels}}">{{ids.sublevels}}, {{ids.description}}</option>
                    {% else %}
                    <option   value="{{ids.sublevels}}">{{ids.sublevels}}, {{ids.description}}</option>
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>

    <div class="rowCajas">
        <!-- Caja de seleccion para ingresar la valoracion de madurez -->
        <div class="contenedorSelector">
            <div class="cajasTextoSelectorValoracion">
                <label style="font-size: 1.4vw;">Valoración de madurez Objetivo</label>
            </div>
            <div class="cajasSelectorValoracion">
                <select  class="selectpicker " data-width="100%" data-size="10"   data-live-search="true" id="valmadob" name="valmadob" >
                    <option selected value="noSel">--- No Seleccionado ---</option>
                    {% for ids in valMad %}
                    {% if ids.sublevels == control.valoracionobjetivo %}
                    <option selected  value="{{ids.sublevels}}">{{ids.sublevels}}, {{ids.description}}</option>
                    {% else %}
                    <option   value="{{ids.sublevels}}">{{ids.sublevels}}, {{ids.description}}</option>
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>

    <div class="rowCajas">
        <div class="cajaPreguntaDescripcion">
            <div class="tarjeta">
                <div class="tituloTarjeta">
                    <div class="cuadrotexto">
                        Criterio de la Valoración
                    </div>

                </div>
                <div class="textoTarjetaGrande">
                    <div class="cuadrotextoGrande">
                        {% for i in criteriovaloracion %}
                        <p> {{i}}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="rowCajas">
        <!-- Tarjeta de pregunta para el control -->
        <div class="cajaPreguntaDescripcion">
            <div class="tarjeta">
                <div class="tituloTarjeta">
                    <div class="cuadrotexto">
                        Evidencia
                    </div>
                </div>
                <div class="textoTarjetaGrande">
                    <div class="cuadrotextoGrande">
                        {% for i in evidencias %}
                        {% if assessment.idioma == "en" %}
                        <p>{{i.evidencia.evidence_request_references}}, {{i.evidencia.artifact}}, {{i.evidencia.artifact_description}} </p>
                        {% else %}
                        <p>{{i.evidencia_id_es.evidence_request_references}}, {{i.evidencia_id_es.artifact}}, {{i.evidencia_id_es.artifact_description}} </p>
                        {% endif %}
                        {% endfor %}
                        {% for i in evidencias2 %}
                        <p>{{i.id_evidencia.evidencia_id}}, {{i.id_evidencia.comentario}}, <a href="{{i.id_evidencia.links}}">{{i.id_evidencia.links}}</a> </p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% if perms.acounts.puede_crear_assesment %}
        <div class="cajaPreguntaDescripcion">
            <div class="tarjeta">
                <div class="tituloTarjeta">
                    <div class="cuadrotexto">
                        Selección de envidencia Generica
                    </div>

                </div>
                <div class="textoTarjeta">
                    {% if recomendacion %}
                    <div class="cuadroInputs">
                        <div class="textoRecomendacionEvidencia">
                            Para este control se recomiendan las evidencias {{ eviRecomendada }}
                        </div>
                        <div class="btnRecomendacionEvidencia">
                            <button style="font-size:1.3vw;" class="btn btn-outline-secondary btn-sm btn-block" type="submit" id="boton8" name="boton8" value="btn8">Añadir</button>
                        </div>
                    </div>
                    {% endif %}
                    <div class="cuadroInputs">
                        <div style="width:60%;" class="form-floating formEvidencia">
                             <select  class="selectpicker" data-width="100%" aria-label="Default select example" data-live-search="true" id="selectorEvidencia" name="selectorEvidencia">
                                <option selected value="noSel">--- No Seleccionado ---</option>
                                {% for ids in evidenciasGenerricas %}
                                <option value="{{ids.evidence_request_references}}">{{ids.evidence_request_references}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="cuadroInputs">
                        <div style="">
                            <button style="font-size:1.3vw;" class="btn btn-outline-secondary btn-lg btn-block" type="submit" id="boton5" name="boton5" value="btn5">seleccionar Evidencia</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    {% if perms.acounts.puede_crear_assesment %}
    <div class="rowCajas">
        <div class="cajaPreguntaDescripcion">
            <div class="tarjeta">
                <div class="tituloTarjeta">
                    <div class="cuadrotexto">
                        Nueva Evidencia
                    </div>

                </div>
                <div class="textoTarjeta">
                    <div class="cuadroInputs">
                        <div style="width:40%;" class="form-floating formEvidencia">
                            <input type="text" class="form-control" id="idEvidencia" name="idEvidencia">
                            <label style="font-size:0.8vw;" for="idEvidencia">ID de la referencia</label>
                        </div>
                        <div style="width:100%;" class="form-floating formEvidencia">
                            <input type="text" class="form-control" id="DescripcionEvidencia" name="DescripcionEvidencia">
                            <label style="font-size:0.8vw;" for="DescripcionEvidencia">Descripcion de la evidencia</label>
                        </div>
                        <div style="width:100%;" class="form-floating formEvidencia">
                            <input type="text" class="form-control" id="linkEvidencia" name="linkEvidencia">
                            <label style="font-size:0.8vw;" for="linkEvidencia">Link de la evidencia</label>
                        </div>
                    </div>
                    <div class="cuadroInputs">
                        <div style="">
                            <button style="font-size:1.3vw;" class="btn btn-outline-secondary btn-lg btn-block" type="submit" id="boton4" name="boton4" value="btn4">Añadir Evidencia</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="rowCajas">

        <div class="cajaPreguntaDescripcion">
            <div class="tarjeta">
                <div class="tituloTarjeta">
                    <div class="cuadrotexto">
                        Crear Iniciativa
                    </div>
                </div>
                <div class="textoTarjeta">

                    <div class="cuadroInputs">
                        <div style="width:60%;" class="form-floating formEvidencia">
                             <select  class="selectpicker" data-width="100%" aria-label="Default select example" data-live-search="true" id="selectorEvidenciaIniciativa" name="selectorEvidenciaIniciativa">
                                <option selected value="noSel">Seleccione la evidencia</option>
                                {% for i in evidencias %}
                                 {% if assessment == 'en' %}
                                <option value="{{i.evidencia.evidence_request_references}}">{{i.evidencia.evidence_request_references}}</option>
                                 {% else %}
                                 <option value="{{i.evidencia_id_es.evidence_request_references}}">{{i.evidencia_id_es.evidence_request_references}}</option>
                                 {% endif %}
                                {% endfor %}
                                {% for i in evidencias2 %}
                                <option value="{{i.id_evidencia.evidencia_id}}">{{i.id_evidencia.evidencia_id}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="cuadroInputs">
                        <div style="width:50%;" class="form-floating formEvidencia">
                            <input type="text" class="form-control" id="nombreIniciativa" name="nombreIniciativa">
                            <label style="font-size:0.8vw;" for="nombreIniciativa">Nombre de la iniciativa</label>
                        </div>
                    </div>
                    <div class="cuadroInputs">
                        <div style="width:90%;" class="form-floating formEvidencia">
                            <input type="text" class="form-control" id="DescripcionIniciativa" name="DescripcionIniciativa">
                            <label style="font-size:0.8vw;" for="DescripcionIniciativa">Descripcion de la iniciativa</label>
                        </div>
                    </div>
                    <div class="cuadroInputs">
                        <div style="width:65%;" class="form-floating formEvidencia">
                            <select  class="form-select" data-width="100%" aria-label="Default select example" data-live-search="true" id="SelectorIniciativa" name="SelectorIniciativa">
                                <option selected value="noSel">--- No Seleccionado ---</option>
                                {% for ids in tiposIniciativas %}
                                <option value="{{ids.tipo}}">{{ids.tipo}}</option>
                                {% endfor %}
                            </select>
                            <label style="font-size:0.8vw;" for="SelectorIniciativa">Seleccione el tipo de iniciativa</label>
                        </div>
                    </div>
                    <div class="cuadroInputs">
                        <div style="">
                            <button style="font-size:1.3vw;" class="btn btn-outline-secondary btn-lg btn-block" type="submit" id="boton6" name="boton6" value="btn6">Crear Iniciativa</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="cajaPreguntaDescripcion">
            <div class="tarjeta">
                <div class="tituloTarjeta">
                    <div class="cuadrotexto">
                        Asignar iniciativa existente
                    </div>
                </div>
                <div class="textoTarjeta">

                    <div class="cuadroInputs">
                        <div style="width:80%;" class="form-floating formEvidencia">
                             <select  class="selectpicker" data-width="100%" aria-label="Default select example" data-live-search="true" id="selectEviasig" name="selectEviasig">
                                <option selected value="noSel">Seleccione la evidencia</option>
                                {% for i in evidencias %}
                                {% if assessment == 'en' %}
                                <option value="{{i.evidencia.evidence_request_references}}">{{i.evidencia.evidence_request_references}}</option>
                                 {% else %}
                                 <option value="{{i.evidencia_id_es.evidence_request_references}}">{{i.evidencia_id_es.evidence_request_references}}</option>
                                 {% endif %}
                                {% endfor %}
                                {% for i in evidencias2 %}
                                <option value="{{i.id_evidencia.evidencia_id}}">{{i.id_evidencia.evidencia_id}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="cuadroInputs">
                        <div style="width:80%;" class="form-floating formEvidencia">
                             <select  class="selectpicker" data-width="100%" aria-label="Default select example" data-live-search="true" id="selectIniAsig" name="selectIniAsig">
                                <option selected value="noSel">Seleccione la iniciativa</option>
                                {% for i in iniciativas %}
                                <option value="{{i.nombre}}">{{i.nombre}}</option>
                                {% endfor %}

                            </select>
                        </div>
                    </div>

                    <div class="cuadroInputs">
                        <div style="">
                            <button style="font-size:1.3vw;" class="btn btn-outline-secondary btn-lg btn-block" type="submit" id="boton7" name="boton7" value="btn7">Asignar Iniciativa</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <div class="rowCajas">
        <div class="cajaPreguntaDescripcion">
            <div class="tarjeta">
                <div class="tituloTarjeta">
                    <div class="cuadrotexto">
                        Iniciativas
                    </div>
                </div>
                <div class="textoTarjetaGrande">
                    <div class="cuadrotextoGrande">
                        {% for i in evidencias %}
                        {% if i.iniciativa %}
                        <p>{{i.iniciativa.nombre}}, {{i.iniciativa.descripcion}}, {{i.iniciativa.tipo.tipo}} </p>
                        {% endif %}
                        {% endfor %}
                        {% for i in evidencias2 %}
                        {% if i.iniciativa %}
                        <p>{{i.iniciativa.nombre}}, {{i.iniciativa.descripcion}}, {{i.iniciativa.tipo.tipo}} </p>
                        {% endif %}
                        {% endfor %}

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="rowCajas">
        <div class="cajaMitad">

        </div>
        <!-- Botones de guardar y archivar -->
        <div class="cajaMitad">
            <div class="cajaBoton">
                <button style="font-size:1.3vw;" class="btn btn-outline-success btn-lg btn-block" type="submit" id="boton2" name="boton2" value="btn2">Guardar Valoración</button>
            </div>
            <div class="cajaBoton">
                <button style="font-size:1.3vw;" class="btn btn-outline-danger btn-lg btn-block" type="button" onclick="clicked(this.form);" id="boton3" name="boton3" value="btn3">Archivar Assessment</button>
            </div>
        </div>
    </div>
    {% endif %}

    {% if messages %}
        {% for message in messages %}
            {% if message.tags %}
                <script type="text/javascript">
                    setTimeout(() => {
                        window.alert("{{ message }}")
                    }, 400);
                </script>
            {% endif %}

        {% endfor %}
    {% endif %}

</form>


<!-- script de javascript de funcion para mostar mensaje guardar el assesment -->
<script type="text/javascript">
    function clicked(form) {
       if (confirm('¿Seguro que quiere archivar el assesment?\n Este no podrá seguir editandose')) {
           form.submit();
       } else {
           return false;
       }
    }

</script>

{% endblock %}



